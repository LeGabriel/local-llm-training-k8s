apiVersion: v1
kind: ConfigMap
metadata:
  name: llmtrain-config
data:
  train.yaml: |
    schema_version: 1
    run:
      name: "k8s-ddp-gpt-wikitext"
      seed: 42
      device: "cpu"
      deterministic: true
      notes: "K8s IndexedJob DDP â€” GPT on WikiText-2, 2 pods, gloo backend."
    model:
      name: "gpt"
      init: "random"
      block_size: 128
      d_model: 256
      n_layers: 6
      n_heads: 8
      d_ff: 1024
      dropout: 0.1
      tie_embeddings: true
    data:
      name: "hf_text"
      cache_dir: ".cache/datasets"
      num_workers: 0
      train_split: "train"
      val_split: "validation"
      dataset_name: "wikitext"
      dataset_config: "wikitext-2-raw-v1"
      text_column: "text"
    trainer:
      max_steps: 100
      micro_batch_size: 2
      grad_accum_steps: 4
      lr: 0.0005
      weight_decay: 0.01
      warmup_steps: 40
      max_grad_norm: 1.0
      log_every_steps: 10
      eval_every_steps: 50
      save_every_steps: 100
    ddp:
      enabled: true
      backend: "gloo"
      init_method: "env://"
      timeout_sec: 1800
      find_unused_parameters: false
      rank: null
      world_size: null
      local_rank: null
      master_addr: null
      master_port: null
    mlflow:
      enabled: true
      tracking_uri: "sqlite:////mlflow/mlflow.db"
      experiment: "llm-train-k8s"
      run_name: "k8s-gpt-wikitext-ddp"
      log_models: false
    logging:
      level: "INFO"
      json_output: true
      log_to_file: true
      file_name: "train.log"
    output:
      root_dir: "/app/runs"
      run_id: null
      save_config_copy: true
      save_meta_json: true
